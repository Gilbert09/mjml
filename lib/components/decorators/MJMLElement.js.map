{"version":3,"sources":["../../../src/components/decorators/MJMLElement.js"],"names":[],"mappings":"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","file":"MJMLElement.js","sourcesContent":["import Immutable from 'immutable'\r\nimport MJMLElementsCollection from '../../MJMLElementsCollection'\r\nimport React, { Component } from 'react'\r\nimport _ from 'lodash'\r\nimport { widthParser } from \"../../helpers/mjAttribute\"\r\nimport { UnknownMJMLElement } from '../../Error'\r\n\r\nconst getElementWidth = ({element, siblings, parentWidth}) => {\r\n  const { elem } = element.props\r\n  let { width } = element.props\r\n\r\n  if (!width && elem && elem.attributes && elem.attributes.width) {\r\n    width = elem.attributes.width\r\n  }\r\n\r\n  if (width == undefined) {\r\n    return parentWidth / siblings\r\n  }\r\n\r\n  const { width: parsedWidth, unit } = widthParser(width)\r\n\r\n  switch(unit) {\r\n    case '%':\r\n      return parsedWidth * parentWidth / 100\r\n\r\n    case 'px':\r\n    default:\r\n      return parsedWidth\r\n  }\r\n}\r\n\r\nfunction createComponent(ComposedComponent, defaultAttributes) {\r\n\r\n  class MJMLElement extends Component {\r\n\r\n    constructor(props) {\r\n      super(props)\r\n\r\n      this.state = Immutable.fromJS({\r\n        elem: _.merge({\r\n          children: [],\r\n          attributes: {},\r\n          inheritedAttributes: []\r\n        }, defaultAttributes)\r\n      })\r\n\r\n      this.state = this.state.mergeDeep(props)\r\n    }\r\n\r\n    mjAttribute(name) {\r\n      if (this.props[name] != undefined) {\r\n        return this.props[name]\r\n      }\r\n\r\n      return this.state.getIn(['elem', 'attributes']).get(name)\r\n    }\r\n\r\n    mjContent() {\r\n      return _.trim(this.state.getIn(['elem', 'content'])) || React.renderToStaticMarkup(this.props.children)\r\n    }\r\n\r\n    mjElementName() {\r\n      return this.state.getIn(['elem', 'tagName']).substr(3)\r\n    }\r\n\r\n    inheritedAttributes() {\r\n      return _.reduce(this.state.getIn(['elem', 'inheritedAttributes']).toJS(), (result, value) => {\r\n        result[value] = this.mjAttribute(value)\r\n        return result\r\n      }, {})\r\n    }\r\n\r\n    isInheritedAttributes(name) {\r\n      return _.indexOf(this.state.getIn(['elem', 'inheritedAttributes']).toJS(), name) != -1\r\n    }\r\n\r\n    siblingsCount() {\r\n      const children = this.state.getIn(['elem', 'children'])\r\n\r\n      return this.hasReactChildren() ?  React.Children.count(children) : this.state.getIn(['elem', 'children']).size\r\n    }\r\n\r\n    getWidth() {\r\n      return this.mjAttribute('rawPxWidth') || this.mjAttribute('width')\r\n    }\r\n\r\n    childDefaultProps(id) {\r\n      return {\r\n        id,\r\n        key: id,\r\n        color: this.mjAttribute('color'),\r\n        parentWidth: this.getWidth(),\r\n        verticalAlign: this.mjAttribute('vertical-align'),\r\n        sibling: this.siblingsCount()\r\n      }\r\n    }\r\n\r\n    renderWrappedOutlookChildren() {\r\n      let elements          = this.renderChildren()\r\n\r\n      if (elements && elements.get) {\r\n        // had to break immutable here :(\r\n        elements = elements.toArray()\r\n      }\r\n\r\n      const wrappedElements = []\r\n      const prefix          = `mj-${this.mjElementName()}-outlook`\r\n      const parentWidth     = this.getWidth()\r\n      const siblings        = elements.length\r\n      const elementsWidth   = elements.map((element) => {\r\n        if (this.isInheritedAttributes('width')) {\r\n          return parentWidth\r\n        }\r\n\r\n        return getElementWidth({element, siblings, parentWidth})\r\n      })\r\n\r\n      if (siblings == 0) {\r\n        return []\r\n      }\r\n\r\n      elements.forEach((element, n) => {\r\n        const width = elementsWidth[n]\r\n\r\n        wrappedElements.push(React.cloneElement(element, _.merge({rawPxWidth: width}, this.inheritedAttributes())))\r\n\r\n        if ( n < elements.length - 1 ) {\r\n          wrappedElements.push(<div key={`outlook-${n}`}className={`${prefix}-line`} data-width={elementsWidth[n+1]}/>)\r\n        }\r\n      })\r\n\r\n      const outlookOpenTag  = <div key=\"outlook-open\" className={`${prefix}-open`} data-width={elementsWidth[0]} />\r\n      const outlookCloseTag = <div key=\"outlook-close\" className={`${prefix}-close`} />\r\n\r\n      return [outlookOpenTag].concat(wrappedElements, [outlookCloseTag])\r\n    }\r\n\r\n    upgradeReactChildren(children) {\r\n      return children.map((child, i) => {\r\n        return React.cloneElement(child, this.childDefaultProps(i))\r\n      })\r\n    }\r\n\r\n    hasReactChildren() {\r\n      const children = this.state.getIn(['elem', 'children'])\r\n\r\n      return !children || children.count() === 0 && React.Children.count(this.props.children) >= 1\r\n    }\r\n\r\n    renderChildren() {\r\n      if (this.hasReactChildren()) {\r\n        return this.upgradeReactChildren(React.Children.toArray(this.props.children));\r\n      }\r\n\r\n      const children = this.state.getIn(['elem', 'children'])\r\n      let i = 0\r\n\r\n      return children.map((elem) => {\r\n        if (elem.get('tagName') && elem.get('tagName').indexOf('mj-') != -1) {\r\n          i++\r\n\r\n          const Element = MJMLElementsCollection[elem.get('tagName').substr(3)]\r\n\r\n          if (!Element) {\r\n            throw new UnknownMJMLElement(`Could not find element for : ${elem.get('tagName')}`)\r\n          }\r\n\r\n          const props = _.merge(this.childDefaultProps(i), {\r\n            elem: elem.toJS()\r\n          })\r\n\r\n          return React.createElement(Element, props)\r\n        }\r\n      })\r\n    }\r\n\r\n    render() {\r\n      return (\r\n        <ComposedComponent\r\n          {...this.props}\r\n          mjAttribute={::this.mjAttribute}\r\n          mjContent={::this.mjContent}\r\n          mjElementName={::this.mjElementName}\r\n          renderChildren={::this.renderChildren}\r\n          renderWrappedOutlookChildren={::this.renderWrappedOutlookChildren} />\r\n      )\r\n    }\r\n\r\n  }\r\n\r\n  return MJMLElement\r\n\r\n}\r\n\r\nexport default (defaultAttributes) => {\r\n  if (typeof defaultAttributes == 'function') {\r\n    return createComponent(defaultAttributes)\r\n  }\r\n\r\n  return ComposedComponent => createComponent(ComposedComponent, defaultAttributes)\r\n}\r\n"]}