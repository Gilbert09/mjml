{"version":3,"sources":["../src/mjml2html.js"],"names":[],"mappings":"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","file":"mjml2html.js","sourcesContent":["import cheerio from \"cheerio\";\r\nimport defaultStyle from \"./defaultStyle\"\r\nimport documentParser from \"./documentParser\";\r\nimport MJMLElementsCollection from \"./MJMLElementsCollection\";\r\nimport { EmptyMJMLError } from './Error';\r\n\r\nimport React from \"react\";\r\nimport ReactDOMServer from \"react-dom/server\";\r\nimport _ from \"lodash\";\r\n\r\nconst debug = require(\"debug\")(\"mjml-engine/mjml2html\");\r\n\r\nconst internals = {\r\n  mjml2html(content, options = {}) {\r\n    let parsedContent = content\r\n\r\n    if (typeof content == \"string\") {\r\n      debug(\"Start parsing content\")\r\n      parsedContent = documentParser(content)\r\n      debug(\"Content parsed.\")\r\n    }\r\n\r\n    debug(\"Start rendering\")\r\n    const render = internals.render({mjml: parsedContent, options})\r\n    debug(\"Done rendering\")\r\n\r\n    return render\r\n  },\r\n\r\n  render({ mjml, options }) {\r\n    const elem  = mjml\r\n    let content = \"\"\r\n\r\n    if (elem) {\r\n      const propsElement = {\r\n        key: 0,\r\n        elem: elem\r\n      }\r\n\r\n      debug(\"Create root React element\")\r\n      const rootElemComponent = React.createElement(MJMLElementsCollection[elem.tagName.substr(3)], propsElement)\r\n\r\n      debug(\"Render to static markup\")\r\n      content = ReactDOMServer.renderToStaticMarkup(rootElemComponent)\r\n    } else {\r\n      throw (new EmptyMJMLError('.render: No MJML to render in options ' + options.toString()))\r\n    }\r\n\r\n    debug(\"React rendering done. Continue with special overrides.\")\r\n\r\n    const $ = cheerio.load(internals.container(options.title), {decodeEntities: false})\r\n\r\n    $(\"#YIELD_MJML\").html(content)\r\n    $(\".mj-raw\").each(function() {\r\n      $(this).replaceWith($(this).html())\r\n    })\r\n\r\n    internals.insertColumnMediaQuery($)\r\n    internals.fixLegacyAttrs($)\r\n    internals.fixOutlookLayout($)\r\n    //internals.mcEditAttr($)\r\n    //internals.mcHideAttr($)\r\n\r\n    return $.html()\r\n  },\r\n\r\n  // mcEditAttr($) {\r\n  //   $('[data-mc-edit]').each(function(i, e) {\r\n  //     let mcEdit = $(e).attr('data-mc-edit');\r\n  //\r\n  //     $(e).attr('mc:edit', mcEdit);\r\n  //     $(e).removeAttr('data-mc-edit')\r\n  //   });\r\n  // },\r\n  //\r\n  // mcHideAttr($) {\r\n  //   $('[data-mc-hide]').each(function(i, e) {\r\n  //     $(e).attr('mc:hideable', true);\r\n  //     $(e).removeAttr('data-mc-hide')\r\n  //   });\r\n  // },\r\n\r\n  insertColumnMediaQuery($) {\r\n    const mediaQuery = $(`<style type=\"text/css\">\r\n    @media only screen and (min-width:480px) {\r\n    </style>`)\r\n\r\n    _.each({\"mj-column-per\": \"%\", \"mj-column-px\": \"px\"}, (unit, className) => {\r\n      const columnWidths = []\r\n\r\n      $(`[class*='${className}']`).each(function() {\r\n        columnWidths.push($(this).data('column-width'))\r\n        $(this).removeAttr('data-column-width')\r\n      })\r\n\r\n      _.uniq(columnWidths).forEach((width) => {\r\n        const mediaQueryClass = `${className}-${width}`\r\n\r\n        mediaQuery.append(`.${mediaQueryClass}, * [aria-labelledby=\"${mediaQueryClass}\"] { width:${width}${unit}!important; }\\n`)\r\n      })\r\n    })\r\n\r\n    mediaQuery.append(`}`)\r\n\r\n    $('head').append(mediaQuery)\r\n  },\r\n\r\n  fixOutlookLayout($) {\r\n    const bodyWidth = $('.mj-body').data('width')\r\n    $('.mj-body').removeAttr('data-width')\r\n\r\n    $(\".outlook-background-fix-open\").each(function() {\r\n      const url = $(this).data('url')\r\n      const width = $(this).data('width')\r\n\r\n      $(this).removeClass('outlook-background-fix-open')\r\n             .removeAttr('data-url')\r\n             .removeAttr('data-width')\r\n\r\n      if (!url) {\r\n        return;\r\n      }\r\n\r\n      $(this).before(`\r\n          <!--[if gte mso 9]>\r\n          <v:rect xmlns:v=\"urn:schemas-microsoft-com:vml\" fill=\"true\" stroke=\"false\" style=\"width:${width}px;\">\r\n            <v:fill origin=\"0.5, 0\" position=\"0.5,0\" type=\"tile\" src=\"${url}\" />\r\n            <v:textbox style=\"mso-fit-shape-to-text:true\" inset=\"0,0,0,0\">\r\n          <![endif]-->`)\r\n\r\n      $(this).after(`\r\n        <!--[if gte mso 9]>\r\n          </v:textbox>\r\n        </v:rect>\r\n        <![endif]-->\r\n      `)\r\n    })\r\n\r\n    $(\".mj-body-outlook-open\").each(function() {\r\n      $(this).replaceWith(`<!--[if mso]>\r\n  \t\t<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"${bodyWidth}\" align=\"center\" style=\"width:${bodyWidth}px;\"><tr><td>\r\n  \t\t<![endif]-->`)\r\n    })\r\n\r\n    $(\".mj-body-outlook-line\").each(function() {\r\n      $(this).replaceWith(`<!--[if mso]>\r\n      </td></tr></table>\r\n  \t\t<![endif]-->\r\n  \t\t<!--[if mso]>\r\n  \t\t<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"${bodyWidth}\" align=\"center\" style=\"width:${bodyWidth}px;\"><tr><td>\r\n  \t\t<![endif]-->`)\r\n    })\r\n\r\n    $(\".mj-body-outlook-close\").each(function() {\r\n      $(this).replaceWith(`<!--[if mso]>\r\n  \t\t</td></tr></table>\r\n  \t\t<![endif]-->`)\r\n    })\r\n\r\n    $(\".mj-section-outlook-open\").each(function() {\r\n      $(this).replaceWith(`<!--[if mso]>\r\n      <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tr>\r\n      <![endif]-->`)\r\n    })\r\n\r\n    $(\".mj-section-outlook-line\").each(function() {\r\n      $(this).replaceWith(`<!--[if mso]>\r\n      </tr><tr style=\"width:${parseInt($(this).data('width'))}px;\">\r\n      <![endif]-->`)\r\n    })\r\n\r\n    $(\".mj-section-outlook-close\").each(function() {\r\n      $(this).replaceWith(`<!--[if mso]>\r\n      </tr></table>\r\n      <![endif]-->`)\r\n    })\r\n\r\n    $(\".outlook-divider-fix\").each(function() {\r\n      const $insertNode = $('<table></table>').css($(this).css())\r\n\r\n      $(this).removeClass(\"outlook-divider-fix\")\r\n             .after(`<!--[if mso]>${$insertNode}<![endif]-->`)\r\n    })\r\n  },\r\n\r\n  fixLegacyAttrs($) {\r\n    const legacyAttrs = [\"align\", \"valign\", \"bgcolor\", \"border\", \"background\"]\r\n\r\n    $(\"#YIELD_MJML\").css({background: $(\".mj-body\").data('background-color')})\r\n    $(\".mj-body\").removeAttr('data-background-color')\r\n\r\n    // https://github.com/facebook/react/issues/140 ...\r\n    // server side workaround to allow custom tags.\r\n    legacyAttrs.forEach((attr) => {\r\n      const dataAttr = `data-legacy-${attr}`\r\n\r\n      $(`[${dataAttr}]`).each(function() {\r\n        $(this).attr(attr, $(this).attr(dataAttr))\r\n        $(this).removeAttr(dataAttr)\r\n      });\r\n    })\r\n  },\r\n\r\n  container(title = '') {\r\n    return `<!doctype html>\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n  <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"/>\r\n  <title>${title}</title>\r\n  <style type=\"text/css\">\r\n    ${defaultStyle}\r\n  </style>\r\n  <!--[if !mso]><!-->\r\n  <style type=\"text/css\">\r\n    @media only screen and (max-width:480px) {\r\n      @-ms-viewport { width:320px; }\r\n      @viewport { width:320px; }\r\n    }\r\n  </style>\r\n  <link href=\"https://fonts.googleapis.com/css?family=Ubuntu:400,500,700,300\" rel=\"stylesheet\" type=\"text/css\">\r\n  <link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.css\" rel=\"stylesheet\" type=\"text/css\">\r\n  <!--<![endif]-->\r\n</head>\r\n<body id=\"YIELD_MJML\">\r\n</body>\r\n</html>\r\n`;\r\n  }\r\n}\r\n\r\nexport default internals.mjml2html;\r\n"]}